# Calibration Optimization Configuration
# 
# For each parameter:
#   optimize = true/false  - Whether to optimize this parameter
#   nominal = value        - Default/starting value
#   min = value            - Minimum bound for optimization
#   max = value            - Maximum bound for optimization
#
# If optimize=false, the nominal value is used as a fixed constant.

[lens1]
# Center position (normalized 0-1, 0.5 = center)
[lens1.center_x]
optimize = true
nominal = 0.5
min = 0.45
max = 0.55

[lens1.center_y]
optimize = true
nominal = 0.5
min = 0.45
max = 0.55

# Field of view in degrees (actual lens FOV, not a scale factor)
[lens1.fov]
optimize = false
nominal = 195.0
min = 180.0
max = 220.0

# Radial distortion coefficients
[lens1.k1]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

[lens1.k2]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

[lens1.k3]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

# Rotation (radians)
[lens1.rotation_yaw]
optimize = true
nominal = 0.0
min = -0.15
max = 0.15

[lens1.rotation_pitch]
optimize = true
nominal = 0.0
min = -0.15
max = 0.15

[lens1.rotation_roll]
optimize = true
nominal = 0.0
min = -0.15
max = 0.15



[lens2]
# Center position (normalized 0-1, 0.5 = center)
[lens2.center_x]
optimize = true
nominal = 0.5
min = 0.45
max = 0.55

[lens2.center_y]
optimize = true
nominal = 0.5
min = 0.45
max = 0.55

# Field of view in degrees - typically shared with lens1
[lens2.fov]
optimize = false
nominal = 190.0
min = 180.0
max = 200.0
use_lens1 = true  # If true and optimize=false, use lens1's optimized/nominal value

# Radial distortion coefficients
[lens2.k1]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

[lens2.k2]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

[lens2.k3]
optimize = true
nominal = 0.0
min = -0.3
max = 0.3

# Rotation (radians)
[lens2.rotation_yaw]
optimize = false
nominal = 0.0
min = -0.15
max = 0.15

[lens2.rotation_pitch]
optimize = false
nominal = 0.0
min = -0.15
max = 0.15

[lens2.rotation_roll]
optimize = false
nominal = 0.0
min = -0.15
max = 0.15



[optimizer]
# Differential evolution settings
maxiter = 100
popsize = 15
strategy = "best1bin"
tol = 0.01
mutation = [0.5, 1.0]
recombination = 0.7

[preprocessing]
# Normalize lighting before computing seam error (converts to grayscale, normalizes mean/std)
# Helps focus on feature alignment rather than brightness differences
normalize_lighting = true

[regularization]
# Set enabled = false to disable all regularization (pure seam error optimization)
enabled = true

# Regularization weights to prevent unrealistic solutions
# E = E_seam + λ_center * ||c - c0||² + λ_fov * (fov - fov0)² + λ_k * ||k||² + λ_rot * ||rot||²
# Set individual lambdas to 0.0 to disable specific terms

# Penalty for centers deviating from nominal (0.5, 0.5)
lambda_center = 100.0

# Penalty for FOV deviating from nominal (195° for Gear360)
# Squared degrees, so 5° deviation gives penalty of lambda * 25
lambda_fov = 0.1

# Penalty for distortion coefficients (k1, k2, k3)
# Encourages small distortion corrections
lambda_distortion = 10.0

# Penalty for rotations (yaw, pitch, roll in radians)
# ~0.1 rad = ~5.7° gives penalty of lambda * 0.01
lambda_rotation = 50.0

# Note: No-overlap penalty is now measured directly from masks (returns 1000.0 if no overlap)
